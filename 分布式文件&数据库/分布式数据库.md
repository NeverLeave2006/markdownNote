# 分布式事务

# 事务
数据库事务(简称:事务，Transaction)，是数据库执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成

事务拥有四个特性，简称ACID

- 原子性(Atomicity): 事务作为一个整体被执行，包含在其中对数据库的操作要么全部执行，要么都不执行
- 一致性(Consistency)： 事务应确保数据库的状态从一个一致状态转变为拎一个一致状态。一致状态是数据库中的数据应满足**完整性约束**，除此之外，一致性还有另外一层语义，就是事务的中间状态不能被观察到(有说这是原子性)
- 隔离性(Isolation)：多个事务并发执行时，一个事务的执行不应影响其他事务的执行，如同只有这一个操作在数据库所执行一样
- 持久性(Durability): 已被提交的事务对数据库的修改应该永久保存在数据库中，在事务结束时，此操作将不可逆转

## 本地事务
起初，事务仅限于对单一数据库资源的访问控制，架构微服务化以后，事务的概念延伸到了服务中。倘若将一个单一服务操作作为一个数据库，那么整个服务操作只能涉及一个单一的数据库资源，这类基于单个单一数据库资源访问的事务，被称为本地事务(Local Transaction)


## 分布式事务

### CAP 理论
分布式事务指事务的参与者，支持事务的服务器，资源服务器以及事务管理器分别处于不同的分布式系统的不同节点之上，且属于不同的应用，分布式事务需要保证这些操作要么全部成功，要么全部失败。本质上来说，分布式事务就是为了保证不同数据库的数据一致性。
最早的分布式事务应用架构很简单，不涉及服务间的访问调用，仅仅是服务内操作涉及到多个数据库资源的访问。

CAP定理理论
Consistency 一致性
Availability 可用性
Partition tolerance 分区容错性
三个指标不能同时满足

对于分布式系统，P(Partition tolerance 分区容错性)是一直成立的
高可用 AP

高一致性: (如:银行转账) CP

单数据源： CA

### BASE理论
Basically Available(基本可用)
- 响应时间损失
- 页面降级

Soft state(软状态)
- 允许系统在多个不同节点的数据副本存在数据延时

Eventually consistent(最终一致性)
- 最终一定能达到一致的状态